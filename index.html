<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥è¯­åŠ¨è¯å˜å½¢è®°å¿†å¡</title>
    <style>
        :root {
            /* é…è‰²å˜é‡ */
            --primary-color: #409eff;
            --primary-hover: #66b1ff;
            --warning-color: #e6a23c;
            --warning-hover: #ebb563;
            --success-color: #67c23a;
            --success-hover: #85ce61;
            --text-main: #303133;
            --text-secondary: #909399;
            --border-color: #ebeef5;
            --bg-header: #f5f7fa;
            --bg-body: #f0f2f5;

            /* é®ç½©å˜é‡ */
            --mask-bg: #a0cfff;
            --mask-hover: #c6e2ff;
            --mask-text-revealed: #409eff;

            /* æ ‡ç­¾é¢œè‰² */
            --tag-g1: #e6a23c;
            --tag-g2: #67c23a;
            --tag-g3: #909399;
            --tag-special: #f56c6c;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: var(--bg-body);
            margin: 0;
            padding: 20px;
            color: #606266;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px 0 rgba(0, 0, 0, 0.1);
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        .header {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        h1 { font-size: 20px; color: var(--text-main); margin: 0; }

        .btn-group { display: flex; gap: 10px; }
        .btn { border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 14px; transition: 0.3s; color: white; }
        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: var(--primary-hover); }
        .btn-default { background-color: var(--text-secondary); }
        .btn-default:hover { background-color: #a6a9ad; }
        .btn-warning { background-color: var(--warning-color); }
        .btn-warning:hover { background-color: var(--warning-hover); }
        .btn-success { background-color: var(--success-color); }
        .btn-success:hover { background-color: var(--success-hover); }

        .tabs { display: flex; border-bottom: 2px solid var(--border-color); margin-bottom: 0; }
        .tab-item { padding: 12px 24px; cursor: pointer; font-size: 15px; color: #606266; transition: all 0.3s; border-bottom: 2px solid transparent; margin-bottom: -2px; font-weight: 500; }
        .tab-item:hover { color: var(--primary-color); }
        .tab-item.active { color: var(--primary-color); border-bottom-color: var(--primary-color); font-weight: bold; }

        .table-wrapper {
            flex: 1;
            overflow: auto;
            border: 1px solid var(--border-color);
            border-top: none;
        }

        table {
            width: max-content;
            min-width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        th, td {
            border-bottom: 1px solid var(--border-color);
            padding: 10px 12px;
            text-align: left;
            font-size: 14px;
            vertical-align: middle;
            border-right: 1px solid var(--border-color);
            white-space: nowrap;
        }

        th {
            background-color: var(--bg-header);
            color: var(--text-secondary);
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th .sub-title {
            font-size: 12px;
            font-weight: normal;
            display: block;
            margin-top: 2px;
            opacity: 0.8;
        }

        /* --- Sticky Columns --- */
        .col-fixed-0 { position: sticky; left: 0; z-index: 11; background-color: #fff; width: 50px; text-align: center; color: #909399; }
        .col-fixed-1 { position: sticky; left: 50px; z-index: 11; background-color: #fff; width: 70px; text-align: center; }
        .col-fixed-2 { position: sticky; left: 120px; z-index: 11; background-color: #fff; width: 100px; }
        .col-fixed-3 { position: sticky; left: 220px; z-index: 11; background-color: #fff; width: 110px; border-right: 2px solid var(--border-color); box-shadow: 4px 0 8px -4px rgba(0,0,0,0.1); }
        th.col-fixed-0, th.col-fixed-1, th.col-fixed-2, th.col-fixed-3 { background-color: var(--bg-header); z-index: 12; }

        /* --- Content Styling --- */
        .tag { font-size: 12px; padding: 3px 8px; border-radius: 10px; color: #fff; font-weight: bold; display: inline-block; }
        .tag-g1 { background-color: var(--tag-g1); }
        .tag-g2 { background-color: var(--tag-g2); }
        .tag-g3 { background-color: var(--tag-g3); }
        .tag-special { background-color: var(--tag-special); }

        .text-kanji {
            font-weight: bold;
            color: var(--text-main);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .text-reading { color: #606266; font-size: 14px; }
        .short-form-text { color: #e6a23c; font-weight: bold; }

        /* --- æœç´¢å›¾æ ‡ --- */
        .search-icon {
            font-size: 14px;
            color: var(--primary-color);
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s;
            text-decoration: none;
        }
        .search-icon:hover {
            opacity: 1;
            transform: scale(1.1);
        }

        /* --- Mask System --- */
        .mask-cell {
            background-color: var(--mask-bg);
            color: transparent;
            border-radius: 4px;
            padding: 6px 10px;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            text-align: center;
            min-width: 80px;
            margin: 2px 0;
            white-space: nowrap;
        }
        .mask-cell:hover { background-color: var(--mask-hover); }
        .mask-cell.revealed { background-color: transparent; color: var(--mask-text-revealed); font-weight: bold; cursor: default; }
        .mask-cell.revealed:hover { background-color: var(--bg-header); cursor: pointer; }
        .mask-cell.revealed.is-short { color: #e6a23c; }

        .mask-mini {
            font-size: 12px;
            display: inline-block;
            padding: 2px 6px;
            height: auto;
            line-height: 1.4;
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: top;
        }

        /* --- Dictionary Modal (å¼¹çª—æ ·å¼) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 8px;
            width: 320px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            text-align: center;
        }
        .modal-title {
            margin: 0 0 20px 0;
            font-size: 18px;
            color: var(--text-main);
        }
        .modal-word {
            color: var(--primary-color);
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
            display: block;
        }
        .dict-btn-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .dict-btn {
            display: block;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            text-decoration: none;
            color: #606266;
            font-size: 15px;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .dict-btn:hover {
            background-color: #f0f9eb;
            color: var(--primary-color);
            border-color: #c2e7b0;
        }
        .modal-close {
            margin-top: 20px;
            padding: 8px 20px;
            background: #f4f4f5;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            color: #909399;
        }
        .modal-close:hover { background: #e9e9eb; }

    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>æ—¥è¯­åŠ¨è¯å˜å½¢ä¸€è§ˆ</h1>
        <div class="btn-group">
            <button class="btn btn-success" id="btn-toggle-cp" onclick="toggleCPMode()">åˆ‡æ¢ï¼šæ ‡å‡†å®Œæ•´å½¢</button>
            <button class="btn btn-warning" id="btn-shuffle">éšæœºä¹±åº</button>
            <button class="btn btn-default" id="btn-reset">é‡ç½®é®ç½©</button>
            <button class="btn btn-primary" id="btn-show-all">å…¨éƒ¨æ˜¾ç¤º</button>
        </div>
    </div>

    <div class="tabs" id="tab-container">
        <div class="tab-item active" data-type="all">å…¨éƒ¨æ˜¾ç¤º</div>
        <div class="tab-item" data-type="group1">ä¸€ç±» (äº”æ®µ)</div>
        <div class="tab-item" data-type="group2">äºŒç±» (ä¸€æ®µ)</div>
        <div class="tab-item" data-type="group3">ä¸‰ç±» (ä¸è§„åˆ™)</div>
        <div class="tab-item" data-type="special" style="color: #f56c6c;">â˜… ç‰¹æ®Š/æ˜“é”™</div>
    </div>

    <div class="table-wrapper">
        <table id="conjugation-table">
            <thead>
            <tr id="table-header-row">
                <th class="col-fixed-0">No.</th>
                <th class="col-fixed-1">ç±»å‹</th>
                <th class="col-fixed-2">æ±‰å­—<span class="sub-title">Basic</span></th>
                <th class="col-fixed-3">è¯»éŸ³<span class="sub-title">Reading</span></th>
            </tr>
            </thead>
            <tbody id="table-body">
            </tbody>
        </table>
    </div>
</div>

<div class="modal-overlay" id="dict-modal">
    <div class="modal-content">
        <h3 class="modal-title">åœ¨çº¿å­—å…¸æŸ¥è¯¢</h3>
        <span class="modal-word" id="modal-word-display">--</span>

        <div class="dict-btn-list">
            <a href="#" target="_blank" class="dict-btn" id="link-mazii">
                <span>Mazii (ç›å‰)</span>
                <span>ğŸ‘‰</span>
            </a>
            <a href="#" target="_blank" class="dict-btn" id="link-jisho">
                <span>Jisho.org</span>
                <span>ğŸ‘‰</span>
            </a>
            <a href="#" target="_blank" class="dict-btn" id="link-weblio">
                <span>Weblio (æ—¥æ—¥)</span>
                <span>ğŸ‘‰</span>
            </a>
            <a href="#" target="_blank" class="dict-btn" id="link-google">
                <span>Google ç¿»è¯‘</span>
                <span>ğŸ‘‰</span>
            </a>
        </div>

        <button class="modal-close" onclick="closeDictModal()">å…³é—­</button>
    </div>
</div>

<script src="verbs-data.js"></script>

<script>
    // ==========================================
    // é…ç½®éƒ¨åˆ†
    // ==========================================

    const columnConfig = [
        { key: 'te', title: 'ã¦å½¢', subtitle: '' },
        { key: 'ta', title: 'ãŸå½¢', subtitle: '' },
        { key: 'nai', title: 'ãªã„å½¢', subtitle: 'å¦å®š' },
        { key: 'causative', title: 'ä½¿å½¹å½¢', subtitle: 'è®©...' },
        { key: 'passive', title: 'è¢«åŠ¨å½¢', subtitle: 'è¢«...' },
        { key: 'causative_passive', title: 'ä½¿å½¹è¢«åŠ¨', subtitle: 'è¢«è¿«...' },
        { key: 'masu', title: 'ã¾ã™å½¢', subtitle: 'ç¤¼è²Œ' },
        { key: 'imperative', title: 'å‘½ä»¤å½¢', subtitle: 'å‘½ä»¤' },
        { key: 'ba', title: 'ã°å½¢', subtitle: 'å‡å®š' },
        { key: 'potential', title: 'å¯èƒ½å½¢', subtitle: 'èƒ½...' },
        { key: 'volitional', title: 'æ„å‘å½¢', subtitle: 'å§/æƒ³' }
    ];

    let currentTab = 'all';
    let useShortForm = false;

    const tableBody = document.getElementById('table-body');
    const tableHeaderRow = document.getElementById('table-header-row');
    const btnToggleCP = document.getElementById('btn-toggle-cp');
    const dictModal = document.getElementById('dict-modal');

    // ==========================================
    // æ ¸å¿ƒé€»è¾‘
    // ==========================================

    function renderHeader() {
        while (tableHeaderRow.children.length > 4) {
            tableHeaderRow.removeChild(tableHeaderRow.lastChild);
        }
        columnConfig.forEach(col => {
            const th = document.createElement('th');
            let titleText = col.title;
            if (col.key === 'causative_passive' && useShortForm) {
                titleText += ' (å£è¯­ç¼©ç•¥)';
            }
            th.innerHTML = `${titleText}<span class="sub-title">${col.subtitle}</span>`;
            tableHeaderRow.appendChild(th);
        });
    }

    function parseBasicData(basicStr) {
        const match = basicStr.match(/^(.*?)\s*\((.*?)\)$/);
        return match ? { kanji: match[1], reading: match[2] } : { kanji: basicStr, reading: '' };
    }

    function splitTeTaData(teTaStr) {
        if (!teTaStr) return { te: '-', ta: '-' };
        const parts = teTaStr.split(' / ');
        return parts.length === 2 ? { te: parts[0], ta: parts[1] } : { te: teTaStr, ta: '-' };
    }

    function convertToShortForm(longForm, typeLabel) {
        if (typeLabel !== 'ä¸€ç±»') return { text: longForm, isShort: false };
        if (longForm.includes('ã•ã›ã‚‰ã‚Œã‚‹')) return { text: longForm, isShort: false };
        if (longForm.includes('ã›ã‚‰ã‚Œã‚‹')) {
            return {
                text: longForm.replace('ã›ã‚‰ã‚Œã‚‹', 'ã•ã‚Œã‚‹'),
                isShort: true
            };
        }
        return { text: longForm, isShort: false };
    }

    function getRawDataByType(type) {
        if (typeof group1Verbs === 'undefined') { alert('é”™è¯¯ï¼šæ— æ³•åŠ è½½ verbs-data.js'); return []; }
        const process = (arr, label, cssClass) => arr.map(item => ({ ...item, typeLabel: label, typeClass: cssClass }));
        if (type === 'group1') return process(group1Verbs, 'ä¸€ç±»', 'tag-g1');
        if (type === 'group2') return process(group2Verbs, 'äºŒç±»', 'tag-g2');
        if (type === 'group3') return process(group3Verbs, 'ä¸‰ç±»', 'tag-g3');
        if (type === 'special') {
            if (typeof specialVerbs === 'undefined') return [];
            return process(specialVerbs, 'ç‰¹ä¾‹', 'tag-special');
        }
        const specials = (typeof specialVerbs !== 'undefined') ? process(specialVerbs, 'ç‰¹ä¾‹', 'tag-special') : [];
        return [...process(group1Verbs, 'ä¸€ç±»', 'tag-g1'), ...process(group2Verbs, 'äºŒç±»', 'tag-g2'), ...process(group3Verbs, 'ä¸‰ç±»', 'tag-g3'), ...specials];
    }

    function shuffleArray(array) {
        const newArr = [...array];
        for (let i = newArr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [newArr[i], newArr[j]] = [newArr[j], newArr[i]];
        }
        return newArr;
    }

    // --- å­—å…¸å¼¹çª—é€»è¾‘ ---
    function openDictModal(word, event) {
        // é˜»æ­¢å†’æ³¡ï¼Œé˜²æ­¢è§¦å‘é®ç½©çš„ç‚¹å‡»
        if(event) event.stopPropagation();

        document.getElementById('modal-word-display').textContent = word;

        // è®¾ç½®å„ä¸ªå­—å…¸çš„é“¾æ¥
        // Mazii (ä¸­æ–‡ç”¨æˆ·å¸¸ç”¨)
        document.getElementById('link-mazii').href = `https://mazii.net/zh-CN/search/word/ja/zh-CN/${word}`;
        // Jisho (è‹±æ–‡è§£é‡Šè¯¦å°½ï¼Œè¯­æ³•åˆ†æå¥½)
        document.getElementById('link-jisho').href = `https://jisho.org/search/${word}`;
        // Weblio (æ—¥æ—¥å­—å…¸ï¼Œæƒå¨)
        document.getElementById('link-weblio').href = `https://www.weblio.jp/content/${word}`;
        // Google (å¤‡ç”¨)
        document.getElementById('link-google').href = `https://translate.google.com/?sl=ja&tl=zh-CN&text=${word}&op=translate`;

        dictModal.classList.add('active');
    }

    function closeDictModal() {
        dictModal.classList.remove('active');
    }

    // ç‚¹å‡»é®ç½©å±‚ä¹Ÿå¯ä»¥å…³é—­
    dictModal.addEventListener('click', function(e) {
        if (e.target === dictModal) closeDictModal();
    });


    function renderTable(dataList) {
        tableBody.innerHTML = '';
        const fragment = document.createDocumentFragment();

        dataList.forEach((verb, index) => {
            const tr = document.createElement('tr');
            const basicInfo = parseBasicData(verb.basic);
            const teTaInfo = splitTeTaData(verb.answers.te_ta);

            // 0. åºå·
            const tdNo = document.createElement('td');
            tdNo.className = 'col-fixed-0';
            tdNo.textContent = index + 1;
            tr.appendChild(tdNo);

            // 1. ç±»å‹
            const tdType = document.createElement('td');
            tdType.className = 'col-fixed-1';
            tdType.innerHTML = `<span class="tag ${verb.typeClass}">${verb.typeLabel}</span>`;
            tr.appendChild(tdType);

            // 2. æ±‰å­— (æ·»åŠ æœç´¢å›¾æ ‡)
            const tdKanji = document.createElement('td');
            tdKanji.className = 'col-fixed-2';
            // æ³¨æ„ï¼šè¿™é‡Œç»™ ğŸ” å›¾æ ‡æ·»åŠ äº† onclick äº‹ä»¶
            tdKanji.innerHTML = `
                <div class="text-kanji">
                    ${basicInfo.kanji}
                    <span class="search-icon" onclick="openDictModal('${basicInfo.kanji}', event)">ğŸ”</span>
                </div>
                <div class="mask-cell mask-mini" data-mask="true" title="${verb.meaning}">${verb.meaning}</div>
            `;
            tr.appendChild(tdKanji);

            // 3. è¯»éŸ³
            const tdReading = document.createElement('td');
            tdReading.className = 'col-fixed-3';
            tdReading.innerHTML = `<div class="text-reading">${basicInfo.reading}</div>`;
            tr.appendChild(tdReading);

            // å˜å½¢åˆ—
            columnConfig.forEach(col => {
                const td = document.createElement('td');
                let content = '';
                let isShortClass = '';

                if (col.key === 'te') content = teTaInfo.te;
                else if (col.key === 'ta') content = teTaInfo.ta;
                else if (col.key === 'causative_passive' && useShortForm) {
                    const result = convertToShortForm(verb.answers[col.key], verb.typeLabel);
                    content = result.text;
                    if (result.isShort) isShortClass = 'is-short';
                } else {
                    content = verb.answers[col.key];
                }

                td.innerHTML = `<div class="mask-cell ${isShortClass}" data-mask="true" title="ç‚¹å‡»æŸ¥çœ‹">${content}</div>`;
                tr.appendChild(td);
            });

            fragment.appendChild(tr);
        });

        tableBody.appendChild(fragment);
    }

    function toggleCPMode() {
        useShortForm = !useShortForm;
        if (useShortForm) {
            btnToggleCP.textContent = "åˆ‡æ¢ï¼šå£è¯­ç¼©ç•¥å½¢";
            btnToggleCP.classList.replace('btn-success', 'btn-warning');
        } else {
            btnToggleCP.textContent = "åˆ‡æ¢ï¼šæ ‡å‡†å®Œæ•´å½¢";
            btnToggleCP.classList.replace('btn-warning', 'btn-success');
        }
        renderHeader();
        const data = getRawDataByType(currentTab);
        renderTable(data);
    }

    function handleTabSwitch(e) {
        if (!e.target.classList.contains('tab-item')) return;
        document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
        e.target.classList.add('active');
        currentTab = e.target.getAttribute('data-type');
        const data = getRawDataByType(currentTab);
        renderTable(data);
    }

    function handleShuffle() {
        const originalData = getRawDataByType(currentTab);
        const shuffledData = shuffleArray(originalData);
        renderTable(shuffledData);
    }

    function toggleAllMasks(show) {
        const masks = document.querySelectorAll('.mask-cell');
        masks.forEach(mask => {
            if (show) mask.classList.add('revealed');
            else mask.classList.remove('revealed');
        });
    }

    tableBody.addEventListener('click', function(e) {
        if (e.target.dataset.mask === "true" || e.target.classList.contains('mask-cell')) {
            e.target.classList.toggle('revealed');
        }
    });

    document.getElementById('tab-container').addEventListener('click', handleTabSwitch);
    document.getElementById('btn-show-all').addEventListener('click', () => toggleAllMasks(true));
    document.getElementById('btn-reset').addEventListener('click', () => toggleAllMasks(false));
    document.getElementById('btn-shuffle').addEventListener('click', handleShuffle);

    (function init() {
        renderHeader();
        const initData = getRawDataByType('all');
        renderTable(initData);
    })();

</script>

</body>
</html>